document.addEventListener("DOMContentLoaded", function () {
const stars = document.querySelectorAll('.stars-svg');
const ratingBox = document.querySelector('.rating-box');
const alreadyRt = document.querySelector('.alreadyRt');
let rating = 0;

stars.forEach((star, index) => {
star.addEventListener('click', () => {
rating = index + 1;
stars.forEach((s, i) => {
if (i < rating) {
s.classList.add('active');
} else {
s.classList.remove('active');
}
});

// Display the rating result
const resultRating = document.querySelector('.result-rating');
resultRating.setAttribute('aria-label', `Bạn đã xếp hạng ${rating} sao`);

// Prevent further ratings
stars.forEach(s => s.classList.add('pointer'));
alreadyRt.style.display = 'block';

// Save rating to Firebase
saveRatingToFirebase(rating);
});
});

function saveRatingToFirebase(rating) {
// Initialize Firebase
firebase.initializeApp(config);
const database = firebase.database();
const postId = "<data:post.id/>";
const userId = firebase.auth().currentUser ? firebase.auth().currentUser.uid : 'anonymous';

database.ref(`ratings/${postId}/${userId}`).set({
rating: rating,
timestamp: firebase.database.ServerValue.TIMESTAMP
});
}
});
