<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
const firebaseConfig = {
apiKey: "AIzaSyBST1RkcBdYg-dXj46gyO-T_RNy08BLTLk",
authDomain: "web-giahuy.firebaseapp.com",
databaseURL: "https://web-giahuy-default-rtdb.firebaseio.com",
projectId: "web-giahuy",
storageBucket: "web-giahuy.appspot.com",
messagingSenderId: "380462958233",
appId: "1:380462958233:web:d88495e6a5b967e0a1da08"
};

firebase.initializeApp(firebaseConfig);

const stars = document.querySelectorAll('.stars-svg');
const ratingBox = document.querySelector('.rating-box');
const alreadyRt = document.querySelector('.alreadyRt');
let rating = 0;

stars.forEach((star, index) => {
star.addEventListener('click', () => {
rating = index + 1;
stars.forEach((s, i) => {
if (i < rating) {
s.classList.add('active');
} else {
s.classList.remove('active');
}
});
// Display the rating result
const resultRating = document.querySelector('.result-rating');
resultRating.setAttribute('aria-label', `Bạn đã xếp hạng ${rating} sao`);
// Prevent further ratings
stars.forEach(s => s.classList.add('pointer'));
alreadyRt.style.display = 'block';
// Save rating to Firebase
saveRatingToFirebase(rating);
});
});

function saveRatingToFirebase(rating) {
const database = firebase.database();
const postId = "<data:post.id/>";
const userId = firebase.auth().currentUser ? firebase.auth().currentUser.uid : 'anonymous';
database.ref(`ratings/${postId}/${userId}`).set({
rating: rating,
timestamp: firebase.database.ServerValue.TIMESTAMP
});
}
});
</script>
